<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì „ë„ ì¼ì¼ í™œë™ ë³´ê³  ì¢…í•©</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background:#f7f7f7; padding:20px; }
    h1 { font-size: 1.4rem; }
    textarea { width:100%; min-height:220px; padding:12px; font-size:14px; box-sizing:border-box; }
    button { padding:10px 14px; font-size:14px; margin-right:8px; cursor:pointer; }
    .result { white-space:pre-wrap; background:#fff; padding:12px; margin-top:12px; border-radius:6px; }
    .warning { margin-top:16px; padding:12px; background:#fff3cd; border:1px solid #ffeeba; border-radius:6px; white-space:pre-wrap; }
  </style>
</head>
<body>
  <h1>ğŸŒ³ ì „ë„ ì¼ì¼ í™œë™ ë³´ê³  ì¢…í•© ğŸŒ³</h1>

  <p>ì•„ë˜ì— <b>ë³´ê³  í…ìŠ¤íŠ¸ ì „ì²´</b>ë¥¼ ê·¸ëŒ€ë¡œ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.</p>
  <textarea id="input"></textarea>

  <div style="margin-top:10px;">
    <button onclick="processReport()">ì¢…í•©í•˜ê¸°</button>
    <button onclick="copyResult()">ğŸ“‹ ê²°ê³¼ ë³µì‚¬</button>
  </div>

  <h3>ğŸ“‹ ì¢…í•© ê²°ê³¼</h3>
  <div id="output" class="result"></div>

  <div id="warnings" class="warning" style="display:none;"></div>

<script>
function processReport() {
  const input = document.getElementById('input').value;
  if (!input.trim()) return;

  const lines = input.split(/\n/);

  const headers = ['ì„­ì™¸ìë³´ìœ ','ë‹¹ì¼ ì°¾ê¸°','ë‹¹ì¼ ì„­ì™¸','ë‹¹ì¼ ë§Œë‚¨','ë‹¹ì¼ ë‹¨ê³„í–¥ìƒ ë§Œë‚¨','ìƒë‹´ë”°ê¸°','ë§ì”€ë”°ê¸°','ì„¼í„°í™•ë‹µ'];
  const totals = Array(headers.length).fill(0);
  const nameMap = {};
  const halfMap = {};

  let outputLines = [];

  for (const line of lines) {
    if (!/^\d+\//.test(line)) continue;

    const cols = line.split('/');
    const area = cols[0];

    headers.forEach((_, i) => {
      const cell = cols[i + 2] || '0';
      const matches = [...cell.matchAll(/([0-9.]+)\(([^)]+)\)/g)];

      if (matches.length === 0) {
        const v = parseFloat(cell);
        if (!isNaN(v)) totals[i] += v;
      } else {
        matches.forEach(m => {
          const v = parseFloat(m[1]);
          if (!isNaN(v)) totals[i] += v;

          const name = m[2].replace(/[0-9.]/g, '').trim();
          if (!nameMap[name]) nameMap[name] = [];
          nameMap[name].push({ area, column: headers[i] });

          if (v === 0.5) {
            if (!halfMap[name]) halfMap[name] = [];
            halfMap[name].push({ area, column: headers[i] });
          }
        });
      }
    });
  }

  const totalLine = 'ì¢…í•©/' + totals.map((v, i) => {
    if (i >= 5) {
      const names = Object.entries(nameMap)
        .filter(([_, arr]) => arr.some(a => a.column === headers[i]))
        .map(([n]) => n);
      return names.length ? `${v}(${[...new Set(names)].join(' ')})` : `${v}`;
    }
    return `${v}`;
  }).join('/');

  lines.forEach(l => {
    if (l.startsWith('ì¢…í•©/')) outputLines.push(totalLine);
    else outputLines.push(l);
  });

  document.getElementById('output').textContent = outputLines.join('\n');

  // ===== í™•ì¸ í•„ìš” ì‚¬í•­ =====
  let warningBlocks = [];

  // 1) .5 ë‹¨ë…
  Object.entries(halfMap).forEach(([name, arr]) => {
    if (arr.length === 1) {
      warningBlocks.push(`â€¢ ${name}\n  - ${arr[0].area}êµ¬ì—­ â†’ ${arr[0].column}`);
    }
  });

  // 2) ê°™ì€ ì´ë¦„, ë‹¤ë¥¸ êµ¬ì—­, ì—­í•  êµ¬ì„±ì´ ë‹¤ë¥´ë©´ ê²½ê³ 
  Object.entries(nameMap).forEach(([name, arr]) => {
    const filtered = arr.filter(a => a.column !== 'ì„­ì™¸ìë³´ìœ ');
    if (filtered.length < 2) return;

    const byArea = {};
    filtered.forEach(a => {
      if (!byArea[a.area]) byArea[a.area] = new Set();
      byArea[a.area].add(a.column);
    });

    const areas = Object.keys(byArea);
    if (areas.length < 2) return;

    const base = [...byArea[areas[0]]].sort().join('|');
    let diff = false;

    for (let i = 1; i < areas.length; i++) {
      const cur = [...byArea[areas[i]]].sort().join('|');
      if (cur !== base) { diff = true; break; }
    }

    if (!diff) return;

    let block = `â€¢ ${name}`;
    Object.entries(byArea).forEach(([area, cols]) => {
      block += `\n  - ${area}êµ¬ì—­ â†’ ${[...cols].join(', ')}`;
    });
    warningBlocks.push(block);
  });

  const warnDiv = document.getElementById('warnings');
  if (warningBlocks.length) {
    warnDiv.style.display = 'block';
    warnDiv.textContent = 'âš ï¸ í™•ì¸ í•„ìš” ì‚¬í•­\n\n' + warningBlocks.join('\n\n');
  } else {
    warnDiv.style.display = 'none';
  }
}

function copyResult() {
  const text = document.getElementById('output').textContent;
  if (!text) return;
  navigator.clipboard.writeText(text);
}
</script>
</body>
</html>
